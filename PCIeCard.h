#pragma once
#include "stdint.h"

/*
??????????????VS2019
*???c???·Ϊ V1.0.0
*/

#include "stdint.h"
#include "stddef.h"
//PCIeCard?υτ???
typedef void* PCIeDeviceHandle;

typedef struct
{
	uint32_t FPGA_DriverVersion;
	uint32_t Aurora_LinkStatus;
	uint32_t DDR4_InitStatus;
}PCIeCard_Status_t;

//?υτ????¦Λ??
typedef struct
{
	uint32_t Slot;
	uint32_t Bus;
	uint32_t Dev;
	uint32_t Func;
}PCIeDevicePos_t;

/*****************************************************************************/
/*
* @brief    ??????PCIeCard Lib?·Ϊ
*
* @param	out - VerString???????·Ϊ????????????????????????
*
*
* @return	??
*
******************************************************************************/
void PCIeCard_GetLibVersion(char* VerString);

/*****************************************************************************/
/*
* @brief    ??????PC?????PCIeCard????
*
* @param	??
* @param	Value contains the 32 bit Value to be written at the specified
*           address.
*
* @return	-1  ?????
*           >=0 : ??????????????PCIeCard????
*
******************************************************************************/
int PCIeCard_GetDeviceNum();

/*****************************************************************************/
/*
* @brief    ??????????PCIeCard?υτ
*
* @param	in  - DeviceIndex: PCIeCard???????????????????????????PCIeCard????
*
* @return	??????PCIeCard?υτ?????NULL??????????GetLastError()?????
*
******************************************************************************/

PCIeDeviceHandle PCIeCard_OpenDeviceWithIdx(int DeviceIndex);

/*****************************************************************************/
/*
* @brief    ????υτ¦Λ???PCIeCard?υτ
*
* @param	in  - PCIeCardPos: PCIeCard??????¦Λ???????slot??bus??dev??func,
???????????????υτ???????§έ??
*
* @return	??????PCIeCard?υτ?????NULL??????????GetLastError()?????
*
******************************************************************************/
PCIeDeviceHandle PCIeCard_OpenDeviceWithPos(PCIeDevicePos_t PCIeCardPos);


/*****************************************************************************/
/*
* @brief    ???PCIeCard?υτ
*
* @param	in  - PCIeDevHandle: PCIeCard?υτ????????PCIeCard_OpenDevice???
*
* @return	??
*
******************************************************************************/
void PCIeCard_CloseDevice(PCIeDeviceHandle PCIeDevHandle);

/*****************************************************************************/
/*
* @brief    ???PCIe????????¦Λ??
*
* @param	in  - DeviceIndex: PCIeCard???????????????????????????PCIeCard????
out - PCIeCardPos: PCIeCard??????¦Λ???????slot??bus??dev??func
*
* @return	??
*
******************************************************************************/
int PCIeCard_GetPosition(int DeviceIndex, PCIeDevicePos_t* PCIeCardPos);


/*****************************************************************************/
/*
* @brief    ????PCIeCard?????????????????
*
* @param	in  - size: ?????????§³????¦Λ??????
*
* @return	????????????????NULL????????????GetLastError()?????
*
******************************************************************************/
void* PCIeCard_Malloc(size_t size);

/*****************************************************************************/
/*
* @brief    ?????????PCIeCard?????????????????
*
* @param	in  - buffer: ??????????????????????
*
* @return	??
*
******************************************************************************/
void PCIeCard_Free(void* buffer);


/*****************************************************************************/
/*
* @brief    ???????υτ??
*
* @param	in  - PCIeDevHandle: PCIeCard?υτ????????PCIeCard_OpenDevice???
*
* @return	PCIeCard_Status_t -  FPGA_DriverVersion : FPGA PCIe?????·Ϊ??
PCIeCard_Status_t -  Aurora_LinkStatus : Aurora????????
1????????????
0????????????????????ό????
PCIeCard_Status_t -  DDR4_InitStatus : PCIeCard DDR4??
1:??????0:??
*
******************************************************************************/
PCIeCard_Status_t PCIeCard_GetStatus(PCIeDeviceHandle PCIeDevHandle);

/*****************************************************************************/
/*
* @brief    ?????§Υ??????(V0.3.12????)
*
* @param	in  - PCIeDevHandle: PCIeCard?υτ????????PCIeCard_OpenDevice???
* @param	in  - Timeout_us: ??§Υ????????¦Λus
*
* @return	??????0??-1???????????????GetLastError()?????
*
******************************************************************************/
uint32_t PCIeCard_SetTimeout(PCIeDeviceHandle PCIeDevHandle, uint32_t Timeout_us);


/*****************************************************************************/
/*
* @brief    ?????§Υ??????(V0.3.12????)
*
* @param	in  - PCIeDevHandle: PCIeCard?υτ????????PCIeCard_OpenDevice???
*
* @return	??????§Υ????????¦Λus,-1???????????????GetLastError()?????
*
******************************************************************************/
uint32_t PCIeCard_GetTimeout(PCIeDeviceHandle PCIeDevHandle);


/*****************************************************************************/
/*
* @brief    ???????????
*
* @param	in  - PCIeDevHandle: PCIeCard?υτ????????PCIeCard_OpenDevice???
* @param	in  - RegOffsetAddr: ????????????????????????
*			user_in_reg0~15??????????????????0x40~0x7C
*			user_out_reg0~15????§Υ??????????????0x0~0x3C
*			?????????4????§³
*
* @return	??????????????
*
******************************************************************************/
uint32_t PCIeCard_ReadUserReg(PCIeDeviceHandle PCIeDevHandle, uint32_t RegOffsetAddr);

/*****************************************************************************/
/*
* @brief    §Υ??????????
*
* @param	in  - PCIeDevHandle: PCIeCard?υτ????????PCIeCard_OpenDevice???
* @param	in  - RegOffsetAddr: ?§Υ?????????????????????
*			user_out_reg0~15???§Υ??????????????0x0~0x3C
*			?????????4????§³
* @param    RegVal???§Υ?????????
*
* @return	0??????-1???????????????GetLastError()?????
*
******************************************************************************/
int PCIeCard_WriteUserReg(PCIeDeviceHandle PCIeDevHandle, uint32_t RegOffsetAddr, uint32_t RegVal);

/*****************************************************************************/
/*
* @brief    ?????????
*
* @param	in  - PCIeDevHandle: PCIeCard?υτ????????PCIeCard_OpenDevice???
* @param	in  - EventID: ???ID?????¦¶?0~15?????FPGA???user_irq0~15
*
* @return	0??????-1???????????????GetLastError()?????
*
* @note		?¨²?????????????????¨²????????????????
******************************************************************************/
int PCIeCard_ReaduUserEvent(PCIeDeviceHandle PCIeDevHandle, int EventID);

/*****************************************************************************/
/*
* @brief    ??PCIeCard§Υ??????
*
* @param	in  - PCIeDevHandle: PCIeCard?υτ????????PCIeCard_OpenDevice???
* @param	in  - WrData: ????????????????????????PCIeCard_Malloc?????buffer????
??????????PCIeCard_Malloc??????????????????
* @param	in  - Size:   ?§Υ????????§³????¦Λ??????Size????4K???????????Aurora???????????

* @return	??????§Υ???????????-1???????????????GetLastError()?????
*
* @note		?¨²????????????????????????
******************************************************************************/
size_t PCIeCard_Write(PCIeDeviceHandle PCIeDevHandle, char* WrData, size_t Size);

/*****************************************************************************/
/*
* @brief    ??PCIeCard???????
*
* @param	in  - PCIeDevHandle: PCIeCard?υτ????????PCIeCard_OpenDevice???
* @param	out - RdData: ????????????????????????PCIeCard_Malloc?????buffer??????
??????????PCIeCard_Malloc??????????????????
* @param	in  - Size:   ??????????§³????¦Λ???

* @return	??????????????????-1???????????????GetLastError()?????
*
* @note		?¨²????????????????????2s
??2s??¦Δ???????????????????????????????
******************************************************************************/
size_t PCIeCard_Read(PCIeDeviceHandle PCIeDevHandle, char* RdData, size_t Size);



////???????????????????????????
int PCIeCard_WriteCtrlReg(PCIeDeviceHandle PCIeDevHandle, uint32_t RegOffsetAddr, uint32_t RegVal);
uint32_t PCIeCard_ReadCtrlReg(PCIeDeviceHandle PCIeDevHandle, uint32_t RegOffsetAddr);
int PCIeCard_WriteInternalReg(PCIeDeviceHandle PCIeDevHandle, uint32_t RegOffsetAddr, uint32_t RegVal);
uint32_t PCIeCard_ReadInternalReg(PCIeDeviceHandle PCIeDevHandle, uint32_t RegOffsetAddr);
//int PCIeCard_WriteFireWallReg(PCIeDeviceHandle PCIeDevHandle, uint32_t RegOffsetAddr, uint32_t RegVal);
//uint32_t PCIeCard_ReadFireWallReg(PCIeDeviceHandle PCIeDevHandle, uint32_t RegOffsetAddr);
//uint32_t PCIeCard_ReadControlReg(PCIeDeviceHandle PCIeDevHandle, uint32_t RegOffsetAddr);
//int PCIeCard_ImmediatelyRead(PCIeDeviceHandle PCIeDevHandle, char* RdData, uintptr_t DeviceAddr, size_t Size);
//int PCIeCard_ImmediatelyWrite(PCIeDeviceHandle PCIeDevHandle, char* WrData, uintptr_t DeviceAddr, size_t Size);